{% extends 'main/base.html' %}

{% block title %}Главная страница{% endblock %}


{% block content %}
    <form class="some-form" style="display: flex; flex-direction: row; flex-wrap: nowrap; gap: 12px;" method="get" action="/">
        <input type="text" name="search" id="search" value="{{ request.GET.search }}" placeholder="Введите текст для поиска" style="flex-grow: 0.85;">
        <button type="submit" style="flex-grow: 0.15;">Найти</button>
    </form>

    <form class="some-form" method="get" action="/">
        <label for="sort">Сортировать по:</label>
        <select name="sort" id="sort" onchange="this.form.submit()">
            <option value="">По умолчанию</option>
            <option value="price_asc" {% if request.GET.sort == 'price_asc' %}selected{% endif %}>Цена (по возрастанию)</option>
            <option value="price_desc" {% if request.GET.sort == 'price_desc' %}selected{% endif %}>Цена (по убыванию)</option>
            <option value="title_asc" {% if request.GET.sort == 'title_asc' %}selected{% endif %}>Название (А-Я)</option>
            <option value="title_desc" {% if request.GET.sort == 'title_desc' %}selected{% endif %}>Название (Я-А)</option>
        </select>
    </form>

    <form class="some-form" method="get" action="/">  {# Форма для range sliders #}
        <label for="price_from">Цена:</label>
        <input type="range" name="price_from" id="price_from" min="0" max="{{ max_price }}" value="{{ price_from_value }}"> {# Используем max_price и values из контекста #}
        <span id="price_from_value">{{ price_from_value }}</span>
        <input type="range" name="price_to" id="price_to" min="0" max="{{ max_price }}" value="{{ price_to_value }}"> {# Используем max_price и values из контекста #}
        <span id="price_to_value">{{ price_to_value }}</span>
        <br><button style="margin-top: 16px;" type="submit">Применить</button>
    </form>
    
    <script>
        const price_from = document.getElementById('price_from');
        const price_from_value = document.getElementById('price_from_value');
        const price_to = document.getElementById('price_to');
        const price_to_value = document.getElementById('price_to_value');
        
        price_from.addEventListener('input', () => {
            price_from_value.textContent = price_from.value;
        });
        
        price_to.addEventListener('input', () => {
            price_to_value.textContent = price_to.value;
        });
    </script>
    <ul>
        {% for service in services %}
        <li>
            <a href="{% url 'service_detail' service.id %}">
                {% if service.images %}
                    <img src="{{ service.images.url }}" alt="{{ service.title }}" style="max-width: 100px;">
                {% endif %}
                <h3>{{ service.title }}</h3>
                <p>Цена: {{ service.price }}</p>
            </a>
            <form method="post" action="{% url 'add_to_cart' service.id %}">
                {% csrf_token %}
                <button type="submit">В корзину</button>
            </form>
        </li>
        {% empty %}
            <li>Нет доступных услуг.</li>
        {% endfor %}
    </ul>
{% endblock %}